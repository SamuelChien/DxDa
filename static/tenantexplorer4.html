<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        font: 13px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .dot {
        stroke: #000;
    }
    
    #filter {
        padding-left: 100px;
    }

    .tooltip {
        position: absolute;
        width: 320px;
        height: 170px;
        pointer-events: auto;
        border: 1px solid;
        padding: 2px;
        max-width: 450px;
        color: black;
        text-align: left;
        background-color: white;
        background: white;
        opacity: 1.0;
        filter: alpha(opacity=100);    
    }
</style>

<body>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>

        //GEt Current user
        function getCurrentConsoleUser() {
            var consoleuser = "";
            $.ajax({
                type: "GET",
                url: "/user",
                success: function (data) {
                    console.log("data:" + data);
                    consoleuser = data;
                },
                async: false
            })
            return consoleuser == null ? "" : consoleuser;
        };
        
        //Do logging
        //var consoleuser = getCurrentConsoleUser();
       // document.getElementById('logging').src = "http://hs-spades-01:419/log2.php?alias=" + "TenantListPage" + "&consoleuser=" + consoleuser + "&page_url=" + encodeURIComponent(window.location.href);

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 1000 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

var xValue = function (d) { return d.Xcoord; }, // data -> value
    x = d3.scale.linear().range([0, width]);

        var yValue = function (d) { return d.Ycoord; }, // data -> value
            y = d3.scale.linear().range([height, 0]);


var color = d3.scale.category10();

var axisNames = {
                    petalWidth: 'Petal Width',
                    petalLength: 'Petal Length',
                    sepalWidth: 'Sepal Width',
                    sepalLength: 'Sepal Length'
                };

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");


var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the tooltip area to the webpage
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

d3.csv("H_TenantsPCACoord.csv", function (error, data) {
  data.forEach(function(d) {
      d.Xcoord = +d.PCA1;
      d.Ycoord = +d.PCA2;
    //d.sepalLength = +d.sepalLength;
    //d.sepalWidth = +d.sepalWidth;
  });
    // don't want dots overlapping axis, so add in buffer to data domain
  x.domain([d3.min(data, xValue) - 0.1, d3.max(data, xValue) + 0.3]);
  y.domain([d3.min(data, yValue) - 0.1, d3.max(data, yValue) + 0.1]);

  //x.domain(d3.extent(data, function (d) { return d.Xcoord; })).nice();
  //y.domain(d3.extent(data, function (d) { return d.Ycoord; })).nice();

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Dimension 1");

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Dimension 2")

 var circles = svg.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 3.5)
      .attr("cx", function (d) { return x(d.Xcoord); })
      .attr("cy", function (d) { return y(d.Ycoord); })
      //.style("fill", function (d) { return color(d.Legend4); })
      //.style("fill", function (d) { if (d.TotalUsers < TenantSz.value) return "white"; else return "red"; })
        .on("mouseover", function (d) {
            tooltip.transition()
                .duration(200)
                .style("opacity", 1.0);
            tooltip.html(//"Name:       " + d["OrgName"] + "<br/> " +
                        '<a href="http://hs-spades-01/static/tenant.html?TenantId=' + d["TenantId"] + '" target="_blank">' + d["OrgName"] + "</a><br/>" +
                        "TenantId: " + d["TenantId"] + "<br/>" +
                        "Total Users: " + d["TotalUsers"] + "<br/>" +
                        "EXOEnabled Users: " + d["EXOEnabledUsers"] + "<br/>" +
                        "SPOEnabled Users: " + d["CloudEnabledUsers"] + "<br/>" +
                        "GoogleAddin Users: " + d["GoogleAddinUsers"] + "<br/>" +
                        "<br/>" +
                        "WXPCloud Users: " + d["WXPCloudUsers"] + "<br/>" +
                        "Users Sent Attachment: " + d["UsersSentAttachment"] + "<br/>" +
                        "Users Sent GoogleLink: " + d["UsersSentGoogleLink"] + "<br/>" +
                        "Users Sent SPOLink: " + d["UsersSentSPOLink"]
                        )
                .style("left", (d3.event.pageX + 5) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
        })
        .on("mouseout", function (d) {
            tooltip.transition()
                    .duration(5000)
                           .style("opacity", 0);
        });

  var legend = svg.selectAll(".legend")
      .data(color.domain())
      .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });


  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);


  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });

  d3.selectAll("[name=v]").on("change", function() {
      var selected = this.value;
      display = this.checked ? "inline" : "none";
      console.log(this.value)
      console.log(display)
      svg.selectAll(".dot")
      .filter(function (d) { return selected == d.Legend; })
      .attr("display", display);
  });

// slide bar filter
   d3.selectAll("[name=TenantSz]").on("change", function () {
       var selected = this.value;
       //display = this.checked ? "inline" : "none";
       console.log(selected)
       svg.selectAll(".dot")
       //.filter(function (d) { return parseInt(selected) > parseInt(d.TotalUsers) })
       //.forEach(function (d) { return selected <= d.TotalUsers })
       //.style("fill", function (d) { if (d.TotalUsers < this.value) return "white"; else return "red"; })
       .attr("display", function (d) { if (parseInt(d.TotalUsers) > parseInt(selected)) return "inline"; else return "none" });
   });
});
    </script>

    <div id="filterNew">
        <b>Tenant Filter:</b>
        <br>
        <input name="v" value="Others" type="checkbox" checked>Others</input>
        <br>
        <input name='v' value="Sent Google links" type="checkbox" checked>Sent Google links</input>
        <br>
        <input name="v" value="Have Google Addin" type="checkbox" checked>Have Google Addin</input>
    </div>
    <h2>Tenant Size</h2>
    <div style="font-size:14px;font-family:sans-serif" id="slider">
        Size of tenants:
        <input name="TenantSz" id="TenantSzId" style="position:relative;top:4px;" type="range" min="250" max="300000" value="250" oninput="TenantSzOutputId.value = TenantSzId.value">
        <output name="TenantSzOutput" id="TenantSzOutputId">250</output>
    
    <!--<code>d3.slider().value([10, 25 ])</code>
    <div id="slider2"></div>-->

    <!--<form id="mark">
        <b>Size of Mark:</b>
        <div><input type="radio" name="sepal" value='sepalWidth'>Sepal Width</div>
        <div><input type="radio" name="sepal" value="sepalLength">Sepal Length</div>
    </form>
    <div id="label"><b>x-Axis:</b></div>
    <select name="xAX" id="xAXs">
        <option value="petalWidth">petalWidth</option>
        <option value="petalLength">petalLength</option>
        <option value="sepalLength">sepalLength</option>
        <option value="sepalWidth">sepalWidth</option>
    </select>
    <div id="label2"><b>y-Axis:</b></div>
    <select name="yAX" id="yAXs">
        <option value="petalLength">petalLength</option>
        <option value="petalWidth">petalWidth</option>
        <option value="sepalLength">sepalLength</option>
        <option value="sepalWidth">sepalWidth</option>
    </select>-->
    <br>
        <iframe id="logging" src="" onload="this.width=700;this.height=0;" frameBorder="0"></iframe>
</body>